<%= f.fields_for :trade_normal_method do |ff| %>
  <div class="form-group form-md-line-input">
    <label class="col-md-2 control-label">Điểm vào
      <span class="required" aria-required="true"> * </span> :</label>
    <div class="col-md-4">
      <%= ff.number_field :point_entry, as: :string, class: 'form-control', placeholder: 'Nhập điểm entry' %>
      <div class="form-control-focus"></div>
    </div>
    <label class="col-md-2 control-label">Mục tiêu (%)
      <span class="required" aria-required="true"> * </span> :</label>
    <div class="col-md-4">
      <%= ff.number_field :target, as: :string, class: 'form-control', placeholder: '% lợi nhuận' %>
      <div class="form-control-focus"></div>
    </div>
  </div>

  <div class="form-group form-md-line-input">
    <label class="col-md-2 control-label">Dừng lãi
      <span class="required" aria-required="true"> * </span> :</label>
    <div class="col-md-4">
      <%= ff.number_field :take_profit, as: :string, class: 'form-control' %>
      <div class="form-control-focus"></div>
    </div>
    <label class="col-md-2 control-label">Dừng lỗ
      <span class="required" aria-required="true"> * </span> :</label>
    <div class="col-md-4">
      <%= ff.number_field :stop_loss, as: :string, class: 'form-control' %>
      <div class="form-control-focus"></div>
    </div>
  </div>
<% end %>

<script>
    $(document).ready(function () {
        // $("#show-main-modal").click(function () {
        //     $("#main-modal").modal("show");
        // });

        // $('#trade_status').on('change', function() {
        //   if($(this).val() != '' && $(this).val() != 'close') {
        //     $("#tradeForm").ajaxSubmit();
        //   }
        // });


        // $("#building_agreement").change(function () {
        //     $.ajax({
        //         type: "GET",
        //         url: '/admin/rooms.json?building_id=' + $("#building_agreement").val() + '&is_agreement=1&last_room=' + $("#last_room").val(),
        //         data: JSON.stringify({
        //             building_id: $("#building_agreement").val(),
        //             is_agreement: 1,
        //             last_room: $("#last_room").val()
        //         }),
        //         contentType: "application/json; charset=utf-8",
        //         dataType: "json",
        //         success: success,
        //         error: error
        //     });
        //     function success(data, status) {
        //         $("#room_agreement").html("");
        //         $("#room_agreement").append("<option value='0'>-- Chọn phòng trọ --</option>");
        //         data.forEach(appendOption)
        //     }
        //     function appendOption(item, index, arr) {
        //         var htmlOption = "<option value=" + item.id + ">" + item.name + " - " + item.amount + " - " + room_type(item.room_type) + " - " + format_money(item.cost) + "</option>"
        //         $("#room_agreement").append(htmlOption);
        //     }
        //     function error() {
        //         console.log('Lỗi lấy dữ liệu phòng theo tòa nhà');
        //     }
        //     function room_type(type) {
        //         if (type == 0) {
        //             return "ĐƠN";
        //         }
        //         else if (type == 1) {
        //             return "KTX";
        //         }
        //     }
        //     function room_type(type) {
        //         if (type == 0) {
        //             return "ĐƠN";
        //         }
        //         else if (type == 1) {
        //             return "KTX";
        //         }
        //     }
        // });
        // function format_money(cost, has_unit = true) {
        //     var price = cost.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.");
        //     if (cost.toString() != '') {
        //         if (has_unit) {
        //             price = price + ' VNĐ';
        //         }
        //         else {
        //             price = price;
        //         }
        //     }
        //     return price;
        // }
        // $("#room_agreement").change(function () {
        //     caculatePrePayment();
        // });
        // $("#month_pre_payment").change(function () {
        //     caculatePrePayment();
        // });
        // function caculatePrePayment() {
        //     var room_name = $("#room_agreement option:selected").text();
        //     if (room_name.indexOf(" - ") > 0) {
        //         var strs = room_name.split(" - ");
        //         if (strs.length == 4) {
        //             var month = $("#month_pre_payment").val();
        //             var money = parseInt(month) * parseInt(strs[3].replace(/\./g, ''));
        //             $('#pre_payment').val(format_money(money, false));
        //         }
        //         else {
        //             $('#pre_payment').val(0);
        //         }
        //     }
        //     else {
        //         $('#pre_payment').val(0);
        //     }
        // }
        $("#trade_trade_normal_method_attributes_point_entry, #trade_trade_normal_method_attributes_target").change(function () {
            var entry = parseFloat($('#trade_trade_normal_method_attributes_point_entry').val());
            var target = parseFloat($('#trade_trade_normal_method_attributes_target').val());
            if( entry != '' && target != ''){
              $('#trade_trade_normal_method_attributes_take_profit').val((target/100)/0.99925 + entry)
            }
            // var durationMonth = $('#durationMonth').val();
            // if (durationMonth != "") {
            //     // console.log("null ok");
            //     var startDate = $('#startDate').val();
            //     var dt1 = parseInt(startDate.substring(0, 2));
            //     // console.log(dt1);
            //     var mon1 = parseInt(startDate.substring(3, 5)) - 1;
            //     // console.log(mon1);
            //     var yr1 = parseInt(startDate.substring(6, 10));
            //     // console.log(yr1);
            //     var time = new Date(yr1, mon1, dt1);
            //     time.setMonth(time.getMonth() + parseInt(durationMonth));
            //     var endDate = time.getDate() + "/" + (time.getMonth() + 1) + "/" + time.getFullYear();
            //     // console.log(endDate);
            //     $("#endDate").val(endDate);
            // } else {
            //     $("#endDate").val("");
            // };
        });
    });
</script>